Bitrix Adaper
=============

Вспомогательная библиотека для работы с CMS Bitrix.

В основе - шаблон проектирования Адаптер как обертка вокруг API. Часть классов попросту скрывают "неудобный" или "плохой ООП" вызов штатного метода или возвращают ссылку на глобальную переменную.
Другая часть также предварительно обрабатывает результаты вызова метода.

Дополнительно содержатся вспомогательные классы.

Основные классы находятся в каталоге `core` и `mvc`, дополнительные - в `lib`.

Классы подчиняются стандарту наименования `"BitrixAdapter{$ClassName}"` и хранятся в файле `"BitrixAdapter{$ClassName}.php"`.
Исключения по наименованию: `BFactory` с целью сокращения длины, а также семейство классов для шаблона MVC: `BAController`, `BALayout`, `BAModel`, `BAView`.
Исключения по названию файлов: файлы в каталогах `core` и `mvc`, классы `BitrixAdapter`, `BFactory`.


Инициализация
-------------

В любом месте до использования (например, файл `header.php`) вставить код:

    CModule::AddAutoloadClasses('', array('BitrixAdapter' => '/bitrixadapter/adapter.php'));
    BitrixAdapter::init();
    
Для повсеместного использования, кроме админки - добавить в файл `/bitrix/php_interface/init.php`
    
Установка параметров (не обязательно):
    
    BFactory::setLanguage('en');
    
Доступные языки и язык по умолчанию определяются в файле `config/block.json`.
Текущий язык определяет поведение отдельных классов, например `BitrixAdapterBlock`.

Подключение дополнительных классов:

    BFactory::load(array('lib', 'thumbnail', 'JS', 'router'));
    // подключение одного:
    BFactory::load('messages');
    
Дополнительные классы размещены в каталоге `lib`.


Настройки
---------

Файлы настроек - в каталоге `config` в формате `JSON`.


Class BitrixAdapter
-------------------

Класс, инициирущий всю библиотечную систему.


Class BFactory
--------------

Фабрика объектов. Дополнительно - "алиасы" вызовов популярных методов других классов.

Объект базы данных CDataBase:

    object BFactory::getDbo();

Объект пользователя CUser:

    object BFactory::getUser();
    
Объект BitrixAdapterBlock:

    object BFactory::getBlock();

Получение ID инфоблока по его алиасу:

    int BFactory::_()->getId('articles')

Алиас должен быть прописан в настройках инфоблока. Дополнительные правила задаются в файле настроек `config/block.json`.

В секции `variables` указывается соответствие алиасов по языкам. Например, `en_{ALIAS}` при получении news будет трансформирован в en_news, что позволяет копировать код из английской версии в русскую, не заботясь об ID инфоблоков.

В секции `constants` жестко определяются ID инфоблоков, соответствующие алиасам.

Если соответствующий инфоблок не найден, используется ID инфоблока на языке по умолчанию.

При получении свойств объекта вызывается метод getId(variable). Таким образом, прошлый вызов также может быть записан так:

    int BFactory::_()->articles


Class BitrixAdapterBlock
------------------------

Работа с инфоблоками


Class BitrixAdapterMenu
-----------------------

Работа с меню

Конвертация штатного вывода меню в массив:

    array BitrixAdapterMenu::plainToArray($arResult)

    
Дополнительные классы
---------------------


`BitrixAdapterLib` - вспомогательный класс с разнородными методами

`BitrixAdapterThumbnail` - создание миниатюр

`BitrixAdapterJS` - подключение RequireJS

`BitrixAdapterRouter` - роутинг

`BitrixAdapterMessages` - сообщения

Загрузка дополнительных классов:

    BFactory::load('ClassName');
    // пример, загружающий BitrixAdapterMessages:
    BFactory::load('Messages');

